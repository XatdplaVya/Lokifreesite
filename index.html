<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Claim Credential — Glass UI</title>
  <style>
    :root{
      --bg:#0f1724;
      --glass-bg: rgba(255,255,255,0.06);
      --card-border: rgba(255,255,255,0.08);
      --accent: rgba(99,102,241,1);
      --accent-soft: rgba(99,102,241,0.16);
      --muted: rgba(255,255,255,0.7);
      --success: #10b981;
    }
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial}
    body{
      background: radial-gradient(800px 400px at 10% 10%, rgba(99,102,241,0.12), transparent 10%),
                  radial-gradient(600px 300px at 90% 90%, rgba(16,185,129,0.06), transparent 10%),
                  var(--bg);
      -webkit-font-smoothing:antialiased;color: #e6eef8;
      display:flex;align-items:center;justify-content:center;padding:24px;box-sizing:border-box
    }/* glass container */
.card{
  width:100%;max-width:880px;border-radius:14px;padding:28px;box-sizing:border-box;
  background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
  border:1px solid var(--card-border);
  backdrop-filter: blur(12px) saturate(120%);
  -webkit-backdrop-filter: blur(12px) saturate(120%);
  box-shadow: 0 10px 30px rgba(2,6,23,0.6);
  position:relative;overflow:hidden
}

/* top decorative gradient */
.card::before{
  content:"";position:absolute;inset:0;pointer-events:none;
  background: linear-gradient(120deg, rgba(99,102,241,0.06), rgba(16,185,129,0.03));
  mix-blend-mode: screen;opacity:0.9;border-radius:inherit
}

header{display:flex;align-items:center;gap:14px;margin-bottom:18px}
.logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#06b6d4);display:flex;align-items:center;justify-content:center;font-weight:700;color:white;box-shadow:0 6px 18px rgba(99,102,241,0.12)}
h1{font-size:18px;margin:0}
p.lead{margin:0;color:var(--muted);font-size:13px}

.controls{display:flex;gap:12px;align-items:center;margin-top:10px}
input[type="text"]{
  flex:1;padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit;font-size:14px
}

.btn{
  padding:10px 16px;border-radius:10px;border:0;background:linear-gradient(180deg,var(--accent),#4f46e5);color:white;font-weight:600;cursor:pointer;box-shadow:0 8px 18px rgba(79,70,229,0.18);transition:transform .14s ease,opacity .14s ease
}
.btn:active{transform:translateY(1px)}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);box-shadow:none}

#result{margin-top:18px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:14px;border-radius:10px;border:1px solid rgba(255,255,255,0.03)}

pre.cred{margin:6px 0;padding:12px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace}

.muted{color:var(--muted);font-size:13px}
.small{font-size:12px;color:rgba(230,238,248,0.7)}

.meta{display:flex;justify-content:space-between;align-items:center;margin-top:12px;gap:10px}
.device{font-family:ui-monospace,monospace;background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;font-size:13px}

/* status pill */
.pill{display:inline-block;padding:6px 10px;border-radius:999px;font-size:13px}
.pill.ok{background:linear-gradient(90deg, rgba(16,185,129,0.12), rgba(16,185,129,0.04));color:var(--success);border:1px solid rgba(16,185,129,0.07)}
.pill.no{background:linear-gradient(90deg, rgba(244,63,94,0.06), rgba(244,63,94,0.02));color:#f43f5e;border:1px solid rgba(244,63,94,0.06)}

footer{margin-top:18px;display:flex;justify-content:space-between;align-items:center}

/* responsive */
@media (max-width:640px){
  .controls{flex-direction:column}
  header{gap:10px}
  .logo{width:44px;height:44px}
}

  </style>
</head>
<body>
  <div class="card" role="main">
    <header>
      <div class="logo">C</div>
      <div>
        <h1>Claim email & password</h1>
        <p class="lead">One claim per device every 24 hours · Client-only demo (public JSON)</p>
      </div>
    </header><div class="controls">
  <input id="jsonUrl" type="text" placeholder="Paste raw JSON URL (raw.githubusercontent.com/...)" aria-label="Raw JSON URL" />
  <button id="btn" class="btn">Claim Now</button>
  <button id="statusBtn" class="btn ghost">Check</button>
</div>

<div id="result">
  <div class="muted">Enter the raw JSON URL from your GitHub repo, then press <strong>Claim Now</strong>.</div>
</div>

<div class="meta">
  <div class="device">Device id: <span id="deviceId" style="margin-left:8px;font-weight:600"></span></div>
  <div id="elig" class="small"></div>
</div>

<footer>
  <div class="small">Note: This is client-only. For true one-time claims use a backend.</div>
  <div class="small muted">Supports WebView `window.ANDROID_DEVICE_ID` or localStorage fallback</div>
</footer>

  </div><script>
// --- device id ---
function getDeviceId(){
  if (window.ANDROID_DEVICE_ID) return window.ANDROID_DEVICE_ID;
  try{
    let id = localStorage.getItem('pseudo_device_id_v1');
    if (!id){ id = 'web-' + Math.random().toString(36).slice(2) + '-' + Date.now().toString(36); localStorage.setItem('pseudo_device_id_v1', id); }
    return id;
  }catch(e){ return 'web-unknown-' + Date.now(); }
}
const deviceId = getDeviceId();
document.getElementById('deviceId').innerText = deviceId;

// storage helpers
function getLastClaimTs(devId){ try{ const map = JSON.parse(localStorage.getItem('claims_ts_v1')||'{}'); return map[devId] || null; }catch(e){return null;} }
function setLastClaimTs(devId, ts){ try{ const map = JSON.parse(localStorage.getItem('claims_ts_v1')||'{}'); map[devId]=ts; localStorage.setItem('claims_ts_v1', JSON.stringify(map)); }catch(e){} }
function getClaimedIdsForDevice(devId){ try{ const map = JSON.parse(localStorage.getItem('claimed_ids_v1')||'{}'); return map[devId]||[] }catch(e){return []} }
function addClaimedIdForDevice(devId, id){ try{ const map = JSON.parse(localStorage.getItem('claimed_ids_v1')||'{}'); if (!Array.isArray(map[devId])) map[devId]=[]; map[devId].push(id); localStorage.setItem('claimed_ids_v1', JSON.stringify(map)); }catch(e){} }

function secondsToHms(s){ s = Math.max(0, Math.floor(s)); const h=Math.floor(s/3600); s-=h*3600; const m=Math.floor(s/60); const ss=s%60; return `${h}h ${m}m ${ss}s`; }

async function fetchJson(url){ const res = await fetch(url, {cache:'no-store'}); if (!res.ok) throw new Error('Fetch failed: '+res.status); return res.json(); }

const btn = document.getElementById('btn');
const statusBtn = document.getElementById('statusBtn');
const result = document.getElementById('result');
const elig = document.getElementById('elig');

function updateElig(){ const last = getLastClaimTs(deviceId); const now = Date.now(); const oneDay=24*3600*1000; if (!last || now - last >= oneDay){ elig.innerHTML = '<span class="pill ok">Eligible</span>'; } else { const rem = Math.ceil((oneDay - (now-last))/1000); elig.innerHTML = `<span class="pill no">Wait ${secondsToHms(rem)}</span>`; } }
updateElig();

btn.addEventListener('click', async ()=>{
  result.innerHTML='';
  const url = (document.getElementById('jsonUrl').value||'').trim();
  if (!url){ result.innerHTML = '<div style="color:#ffb4b4">Please paste raw JSON URL first.</div>'; return; }

  const last = getLastClaimTs(deviceId); const now = Date.now(); const oneDay=24*3600*1000;
  if (last && now - last < oneDay){ const retry = oneDay - (now-last); result.innerHTML = `<div><strong>Not eligible yet.</strong><div class="muted">Try after ${secondsToHms(Math.ceil(retry/1000))}</div></div>`; updateElig(); return; }

  btn.disabled=true; btn.textContent='Fetching...';
  try{
    const json = await fetchJson(url);
    if (!json || !Array.isArray(json.data)) throw new Error('Invalid JSON format — expected {"data":[...] }');

    const claimedIds = getClaimedIdsForDevice(deviceId);
    let items = json.data.slice();
    items = items.filter((it, idx)=>{ const id = (it.id!==undefined)?String(it.id):String(idx); return !claimedIds.includes(id); });

    if (items.length===0){ result.innerHTML = '<div><strong>No new credentials available for this device.</strong></div>'; return; }

    const picked = items[0]; const pickedId = (picked.id!==undefined)?String(picked.id):String(json.data.indexOf(picked));

    result.innerHTML = `<div style="display:flex;align-items:center;gap:12px"><svg width=36 height=36 viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2a10 10 0 100 20 10 10 0 000-20z" fill="white" opacity="0.06"/><path d="M12 6v6l4 2" stroke="white" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"/></svg><div><div class="small">Claimed credential</div><pre class="cred">${picked.email} / ${picked.password}</pre></div></div><div class="muted">This device cannot claim again for 24 hours.</div>`;setLastClaimTs(deviceId, now);
addClaimedIdForDevice(deviceId, pickedId);
updateElig();

}catch(err){ console.error(err); result.innerHTML = <div style="color:#ffb4b4">Error: ${err.message}</div>; } finally{ btn.disabled=false; btn.textContent='Claim Now'; } });

statusBtn.addEventListener('click', ()=>{ updateElig(); alert(elig.textContent); }); </script>

</body>
</html>
